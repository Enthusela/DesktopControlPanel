version: '3.8'

services:
  web_app:
    build:
      context: ./web_app
      target: development
    container_name: argb_web_app
    ports:
      - "8080:8080"
    devices:
      # Pass through Arduino USB device
      # Update this path based on your Arduino's device path
      - ${SERIAL_PORT:-/dev/ttyACM0}:${SERIAL_PORT:-/dev/ttyACM0}
    privileged: false
    volumes:
      # Mount source code for hot reload during development
      - ./web_app:/app
      # Prevent overwriting node_modules
      - /app/node_modules
    environment:
      - NODE_ENV=${NODE_ENV:-development}
      # Set to 'mock' to disable GPIO on non-Raspberry Pi systems
      - GPIO_MODE=${GPIO_MODE:-mock}
      # Serial port path (can be overridden)
      - SERIAL_PORT=${SERIAL_PORT:-/dev/ttyACM0}
    restart: unless-stopped
    networks:
      - argb_network

networks:
  argb_network:
    driver: bridge
